function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,p=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){p=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(p)throw a}}return o}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,t,r,n,a,o,i){try{var p=e[o](i),l=p.value}catch(e){return void r(e)}p.done?t(l):Promise.resolve(l).then(n,a)}import"cropperjs/dist/cropper.css";import n from"cropperjs";import a from"mime/lite";import{openBlock as o,createElementBlock as i,normalizeClass as p,createElementVNode as l,createCommentVNode as c,withModifiers as s,toDisplayString as u}from"vue";var m={name:"AvatarCropper",emits:["update:modelValue","submit","error","cancel","changed","uploading","completed","uploaded"],props:{modelValue:{type:Boolean,default:!1},file:{type:File},uploadHandler:{type:Function},uploadUrl:{type:String},requestOptions:{type:Object,default:function(){return{method:"POST"}}},uploadFileField:{type:String,default:"file"},uploadFileName:{type:[String,Function]},uploadFormData:{type:FormData,default:function(){return new FormData}},cropperOptions:{type:Object,default:function(){return{aspectRatio:1,autoCropArea:1,viewMode:1,movable:!1,zoomable:!1}}},outputOptions:{type:Object},outputMime:{type:String,default:null},outputQuality:{type:Number,default:.9},mimes:{type:String,default:"image/png, image/gif, image/jpeg, image/bmp, image/x-icon"},capture:{type:String},labels:{type:Object,default:function(){return{submit:"Ok",cancel:"Cancel"}}},inline:{type:Boolean,default:!1}},data:function(){return{cropper:void 0,dataUrl:void 0,fileName:void 0,mimeType:void 0}},computed:{cleanedMimes:function(){if(!this.mimes)throw new Error("vue-avatar-cropper: mimes prop cannot be empty");return this.mimes.trim().toLowerCase()}},watch:{modelValue:function(e){e&&(this.file?this.onFileChange(this.file):this.pickImage(),this.$emit("update:modelValue",!1))}},mounted:function(){this.$emit("update:modelValue",!1)},methods:{destroy:function(){this.cropper&&this.cropper.destroy(),this.$refs.input&&(this.$refs.input.value=""),this.dataUrl=void 0},submit:function(){this.$emit("submit"),this.uploadUrl?this.uploadImage():this.uploadHandler?this.uploadHandler(this.cropper):this.$emit("error",{type:"user",message:"No upload handler found"}),this.destroy()},cancel:function(){this.$emit("cancel"),this.destroy()},onImgElementError:function(){this.$emit("error",{type:"load",message:"File loading failed"}),this.destroy()},pickImage:function(){this.$refs.input&&this.$refs.input.click()},onFileChange:function(e){var t=this;if("image/*"===this.cleanedMimes){if("image"!==e.type.split("/")[0])return void this.$emit("error",{type:"user",message:"File type not correct"})}else if(this.cleanedMimes){var r=this.cleanedMimes.split(", ").find((function(t){return t===e.type}));if(!r)return void this.$emit("error",{type:"user",message:"File type not correct"})}var n=new FileReader;n.onload=function(e){t.dataUrl=e.target.result},n.readAsDataURL(e),this.fileName=e.name||"unknown",this.mimeType=e.type,this.$emit("changed",{file:e,reader:n})},onFileInputChange:function(e){e.target.files&&e.target.files[0]&&this.onFileChange(e.target.files[0])},createCropper:function(){this.cropper=new n(this.$refs.img,this.cropperOptions)},getFilename:function(e){var t=a.getExtension(e.type);if(!this.uploadFileName){var r=this.fileName,n=this.fileName.split(".");return n.length>1&&(r=n.slice(0,-1).join(".")),"".concat(r,".").concat(t)}return"string"==typeof this.uploadFileName?this.uploadFileName:"function"==typeof this.uploadFileName?this.uploadFileName({filename:this.fileName,mime:e.type,extension:t}):"unknown.".concat(t)},uploadImage:function(){var t=this;this.cropper.getCroppedCanvas(this.outputOptions).toBlob(function(){var n,a=(n=regeneratorRuntime.mark((function r(n){var a,o,i,p,l,c,s,u,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(o in a=new FormData,t.uploadFormData.entries())i=e(o,2),p=i[0],l=i[1],a.append(p,l);return a.append(t.uploadFileField,n,t.getFilename(n)),c=Object.assign({body:a},t.requestOptions),s=new Request(t.uploadUrl,c),u=fetch(s),t.$emit("uploading",{form:a,request:s,response:u}),r.next=9,u;case 9:m=r.sent,t.$emit("completed",{form:a,request:s,response:m}),m.ok?t.$emit("uploaded",{form:a,request:s,response:m}):t.$emit("error",{type:"upload",message:"Image upload fail",context:{request:s,response:m}});case 12:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(a,o){var i=n.apply(e,t);function p(e){r(i,a,o,p,l,"next",e)}function l(e){r(i,a,o,p,l,"throw",e)}p(void 0)}))});return function(e){return a.apply(this,arguments)}}(),this.outputMime||this.mimeType,this.outputQuality)}}},d={class:"avatar-cropper"},f={key:0,class:"avatar-cropper-mark"},h=["title"],v={class:"avatar-cropper-container"},g={class:"avatar-cropper-image-container"},y=["src"],b={class:"avatar-cropper-footer"},x=["accept","capture"];!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===r&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}(".avatar-cropper .avatar-cropper-overlay {\n  text-align: center;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 99999; }\n\n.avatar-cropper .avatar-cropper-overlay-inline {\n  position: initial; }\n\n.avatar-cropper .avatar-cropper-img-input {\n  display: none; }\n\n.avatar-cropper .avatar-cropper-close {\n  float: right;\n  padding: 20px;\n  font-size: 3rem;\n  color: #fff;\n  font-weight: 100;\n  text-shadow: 0px 1px rgba(40, 40, 40, 0.3); }\n\n.avatar-cropper .avatar-cropper-mark {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.1); }\n\n.avatar-cropper .avatar-cropper-container {\n  background: #fff;\n  z-index: 999;\n  box-shadow: 1px 1px 5px rgba(100, 100, 100, 0.14); }\n  .avatar-cropper .avatar-cropper-container .avatar-cropper-image-container {\n    position: relative;\n    max-width: 400px;\n    height: 300px; }\n  .avatar-cropper .avatar-cropper-container img {\n    max-width: 100%;\n    height: 100%; }\n  .avatar-cropper .avatar-cropper-container .avatar-cropper-footer {\n    display: flex;\n    align-items: stretch;\n    align-content: stretch;\n    justify-content: space-between; }\n    .avatar-cropper .avatar-cropper-container .avatar-cropper-footer .avatar-cropper-btn {\n      width: 50%;\n      padding: 15px 0;\n      cursor: pointer;\n      border: none;\n      background: transparent;\n      outline: none; }\n      .avatar-cropper .avatar-cropper-container .avatar-cropper-footer .avatar-cropper-btn:hover {\n        background-color: #2aabd2;\n        color: #fff; }\n"),m.render=function(e,t,r,n,a,m){return o(),i("div",d,[a.dataUrl?(o(),i("div",{key:0,class:p(["avatar-cropper-overlay",{"avatar-cropper-overlay-inline":r.inline}])},[r.inline?c("",!0):(o(),i("div",f,[l("a",{onClick:t[0]||(t[0]=function(){return m.cancel&&m.cancel.apply(m,arguments)}),class:"avatar-cropper-close",title:r.labels.cancel,href:"javascript:;"},"Ã—",8,h)])),l("div",v,[l("div",g,[l("img",{ref:"img",src:a.dataUrl,alt:"",onLoad:t[1]||(t[1]=s((function(){return m.createCropper&&m.createCropper.apply(m,arguments)}),["stop"])),onError:t[2]||(t[2]=function(){return m.onImgElementError&&m.onImgElementError.apply(m,arguments)})},null,40,y)]),l("div",b,[l("button",{onClick:t[3]||(t[3]=s((function(){return m.cancel&&m.cancel.apply(m,arguments)}),["stop","prevent"])),class:"avatar-cropper-btn"},u(r.labels.cancel),1),l("button",{onClick:t[4]||(t[4]=s((function(){return m.submit&&m.submit.apply(m,arguments)}),["stop","prevent"])),class:"avatar-cropper-btn"},u(r.labels.submit),1)])])],2)):c("",!0),r.file?c("",!0):(o(),i("input",{key:1,accept:m.cleanedMimes,capture:r.capture,class:"avatar-cropper-img-input",ref:"input",type:"file",onChange:t[5]||(t[5]=function(){return m.onFileInputChange&&m.onFileInputChange.apply(m,arguments)})},null,40,x))])};var F={install:function(e){e.component("avatar-cropper",m)}};export{F as default};
